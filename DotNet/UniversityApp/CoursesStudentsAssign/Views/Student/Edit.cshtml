@* @{
    ViewData["Title"] = "Edit Student";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Your App Name</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2>Edit Student</h2>
        <form id="editStudentForm">
            <input type="hidden" id="studentId" value="@ViewBag.StudentId" />
            <div class="mb-3">
                <label for="rollNumber" class="form-label">Roll Number</label>
                <input type="text" id="rollNumber" class="form-control" required />
            </div>
            <div class="mb-3">
                <label for="name" class="form-label">Name</label>
                <input type="text" id="name" class="form-control" required />
            </div>
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" id="email" class="form-control" required />
            </div>
            <div class="mb-3">
                <label for="phone" class="form-label">Phone</label>
                <input type="text" id="phone" class="form-control" />
            </div>
            <div class="mb-3">
                <label for="address" class="form-label">Address</label>
                <input type="text" id="address" class="form-control" />
            </div>
            <div class="mb-3">
                <label for="dateOfBirth" class="form-label">Date of Birth</label>
                <input type="date" id="dateOfBirth" class="form-control" />
            </div>
            <div class="mb-3">
                <label for="gender" class="form-label">Gender</label>
                <select id="gender" class="form-control">
                    <option value="">Select Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Update Student</button>
            <a href="/Student/students" class="btn btn-secondary">Back to List</a>
        </form>
        <p id="msg" class="mt-3"></p>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        const studentId = $("#studentId").val();
        const token = localStorage.getItem("jwtToken");

        // Load existing student data
        if (token) {
            $.ajax({
                url: `https://localhost:7097/api/Student/stud/id/${studentId}`,
                type: "GET",
                headers: { "Authorization": "Bearer " + token },
                success: function (data) {
                    $("#rollNumber").val(data.rollNumber);
                    $("#name").val(data.name);
                    $("#email").val(data.email);
                    $("#phone").val(data.phone);
                    $("#address").val(data.address);
                    $("#dateOfBirth").val(data.dateOfBirth ? data.dateOfBirth.split('T')[0] : '');
                    $("#gender").val(data.gender);
                },
                error: function () {
                    $("#msg").text("Error loading student data.");
                }
            });
        } else {
            $("#msg").text("Please log in first!");
        }

        $("#editStudentForm").submit(function (e) {
            e.preventDefault();
            const student = {
                rollNumber: $("#rollNumber").val(),
                name: $("#name").val(),
                email: $("#email").val(),
                phone: $("#phone").val(),
                address: $("#address").val(),
                dateOfBirth: $("#dateOfBirth").val(),
                gender: $("#gender").val()
            };

            $.ajax({
                url: `https://localhost:7097/api/Student/UpdateStud/${studentId}`,
                type: "PUT",
                headers: { "Authorization": "Bearer " + token, "Content-Type": "application/json" },
                data: JSON.stringify(student),
                success: function () {
                    alert("Student updated successfully!");
                    window.location.href = "/Student/students";
                },
                error: function (xhr) {
                    $("#msg").text("Error: " + xhr.responseText);
                }
            });
        });
    </script>
</body>
</html> *@

@{
    ViewData["Title"] = "Edit Student";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Your App Name</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2>Edit Student</h2>
        <form id="editStudentForm">
            <input type="hidden" id="studentId" value="@ViewBag.StudentId" />
            <div class="mb-3">
                <label for="rollNumber" class="form-label">Roll Number</label>
                <input type="text" id="rollNumber" class="form-control" required />
            </div>
            <div class="mb-3">
                <label for="name" class="form-label">Name</label>
                <input type="text" id="name" class="form-control" required />
            </div>
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" id="email" class="form-control" required />
            </div>
            <div class="mb-3">
                <label for="phone" class="form-label">Phone</label>
                <input type="text" id="phone" class="form-control" />
            </div>
            <div class="mb-3">
                <label for="address" class="form-label">Address</label>
                <input type="text" id="address" class="form-control" />
            </div>
            <div class="mb-3">
                <label for="dateOfBirth" class="form-label">Date of Birth</label>
                <input type="date" id="dateOfBirth" class="form-control" />
            </div>
            <div class="mb-3">
                <label for="gender" class="form-label">Gender</label>
                <select id="gender" class="form-control">
                    <option value="">Select Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="courseId" class="form-label">Course ID</label>
                <select id="courseId" class="form-control" required>
                    <option value="">Select Course</option>
                    <!-- Options will be populated via JavaScript -->
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Update Student</button>
            <a href="/Student/students" class="btn btn-secondary">Back to List</a>
        </form>
        <p id="msg" class="mt-3"></p>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        const studentId = $("#studentId").val();
        const token = localStorage.getItem("jwtToken");

        // Load courses for dropdown
        if (token) {
            $.ajax({
                url: "https://localhost:7097/api/Course/AllCourses",
                type: "GET",
                headers: { "Authorization": "Bearer " + token },
                success: function (courses) {
                    let options = "<option value=''>Select Course</option>";
                    courses.forEach(course => {
                        options += `<option value="${course.courseId}">${course.courseName} (${course.courseCode})</option>`;
                    });
                    $("#courseId").html(options);
                },
                error: function () {
                    $("#msg").text("Error loading courses.");
                }
            });
        }

        // Load existing student data
        if (token) {
            $.ajax({
                url: `https://localhost:7097/api/Student/stud/id/${studentId}`,
                type: "GET",
                headers: { "Authorization": "Bearer " + token },
                success: function (data) {
                    $("#rollNumber").val(data.rollNumber);
                    $("#name").val(data.name);
                    $("#email").val(data.email);
                    $("#phone").val(data.phone);
                    $("#address").val(data.address);
                    $("#dateOfBirth").val(data.dateOfBirth ? data.dateOfBirth.split('T')[0] : '');
                    $("#gender").val(data.gender);
                    $("#courseId").val(data.courseId);  // Set selected course
                },
                error: function () {
                    $("#msg").text("Error loading student data.");
                }
            });
        } else {
            $("#msg").text("Please log in first!");
        }

        $("#editStudentForm").submit(function (e) {
            e.preventDefault();
            const student = {
                rollNumber: $("#rollNumber").val(),
                name: $("#name").val(),
                email: $("#email").val(),
                phone: $("#phone").val(),
                address: $("#address").val(),
                dateOfBirth: $("#dateOfBirth").val(),
                gender: $("#gender").val(),
                courseId: $("#courseId").val()
            };

            $.ajax({
                url: `https://localhost:7097/api/Student/UpdateStud/${studentId}`,
                type: "PUT",
                headers: { "Authorization": "Bearer " + token, "Content-Type": "application/json" },
                data: JSON.stringify(student),
                success: function () {
                    alert("Student updated successfully!");
                    window.location.href = "/Student/students";
                },
                error: function (xhr) {
                    $("#msg").text("Error: " + xhr.responseText);
                }
            });
        });
    </script>
</body>
</html>

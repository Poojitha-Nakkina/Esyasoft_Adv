@{
    ViewData["Title"] = "Delete Student";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Your App Name</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2>Delete Student</h2>
        <p>Are you sure you want to delete this student?</p>
        <p id="studentDetails"></p>
        <button id="deleteBtn" class="btn btn-danger">Yes, Delete</button>
        <a href="/Student/students" class="btn btn-secondary">Cancel</a>
        <p id="msg" class="mt-3"></p>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        const studentId = @ViewBag.StudentId;
        const token = localStorage.getItem("jwtToken");

        // Load student details for confirmation
        if (token) {
            $.ajax({
                url: `https://localhost:7097/api/Student/stud/id/${studentId}`,
                type: "GET",
                headers: { "Authorization": "Bearer " + token },
                success: function (data) {
                    $("#studentDetails").html(`<strong>Name:</strong> ${data.name}<br><strong>Email:</strong> ${data.email}`);
                },
                error: function () {
                    $("#msg").text("Error loading student data.");
                }
            });
        } else {
            $("#msg").text("Please log in first!");
        }

        $("#deleteBtn").click(function () {
            $.ajax({
                url: `https://localhost:7097/api/Student/Delete?id=${studentId}`,  
                type: "DELETE",
                headers: { "Authorization": "Bearer " + token },
                success: function () {
                    alert("Student deleted successfully!");
                    window.location.href = "/Student/students";
                },
                error: function (xhr) {
                    $("#msg").text("Error: " + xhr.responseText);
                }
            });
        });
    </script>
</body>
</html>